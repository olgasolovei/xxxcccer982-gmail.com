@model FallingDetectionService.Api.ViewModels.Incidents.CreateIncidentVm
@{
    Layout = "_Layout";
    ViewData["Title"] = "Create Incident";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h1 class="h5 mb-1">Create Incident</h1>
        <div class="text-muted small">Демо-форма для тесту ingestion + alert.</div>
    </div>
    <a class="btn btn-outline-secondary" href="/IncidentsUi">Back</a>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-body p-4">

        <form method="get" action="/IncidentsUi/CreateForSite" class="row g-3 mb-3">
            <div class="col-md-8">
                <label class="form-label">Site</label>
                <select class="form-select" name="siteId" onchange="this.form.submit()">
                    @foreach (var s in Model.Sites)
                    {
                        <option value="@s.Id" selected="@(Model.SiteId == s.Id)">
                            @s.Name (@s.Location)
                        </option>
                    }
                </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <div class="text-muted small">Зміна Site оновлює Zone/Device dropdown.</div>
            </div>
        </form>

        <form method="post" class="row g-3">
            <input type="hidden" asp-for="SiteId" />

            <div class="col-md-6">
                <label class="form-label">Zone</label>
                <select class="form-select" asp-for="ZoneId">
                    @foreach (var z in Model.Zones)
                    {
                        <option value="@z.Id" selected="@(Model.ZoneId == z.Id)">@z.Name</option>
                    }
                </select>
                <div class="text-muted small">FK-safe: zone належить обраному site.</div>
            </div>

            <div class="col-md-6">
                <label class="form-label">Source (Device)</label>
                <select class="form-select" asp-for="SourceId">
                    @foreach (var d in Model.Devices)
                    {
                        <option value="@d.SourceId" selected="@(Model.SourceId == d.SourceId)">
                            @d.SourceId (@d.Type)
                        </option>
                    }
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label">Confidence (0..10)</label>
                <input class="form-control" asp-for="Confidence" />
            </div>

            <div class="col-md-4">
                <label class="form-label">Timestamp (UTC)</label>
                <input class="form-control" type="datetime-local" name="Timestamp"
                       value="@Model.Timestamp.ToString("yyyy-MM-ddTHH:mm")" />
            </div>

            <div class="col-12">
                <label class="form-label">EvidenceRef</label>
                <input class="form-control" asp-for="EvidenceRef" />
                <div class="text-muted small">Напр.: s3://bucket/frame.jpg або demo://evidence</div>
            </div>

            <div class="col-12 d-flex gap-2">
                <button class="btn btn-primary" type="submit">Create</button>
                <a class="btn btn-outline-secondary" href="/IncidentsUi">Cancel</a>
            </div>
        </form>

    </div>
</div>
